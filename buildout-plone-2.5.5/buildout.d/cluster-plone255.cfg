[buildout]

extends =
    base-plone255.cfg

products-list = ${buildout:directory}/etc/Products_SingUpSheet.txt
zeo-address = 0.0.0.0:8000 
supervisor-address = 8081
haproxy-address = 8082
client1-address = 8001
client2-address = 8002
client3-address = 8003
client4-address = 8004

parts +=
    Products
    client1
    client2
    zeoserver
    haproxy-build
    haproxy-conf
    supervisor
    stats
    

eggs +=
    PyPDF
    collective.stats
    Products.LongRequestLogger


[Products]
recipe = plone.recipe.command
command =
    svn co https://apore.presidencia.gov.br/svn/projetosweb/Hotfix/PloneHotfix20110720 ${buildout:directory}/products/PloneHotfix20110720
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/AddRemoveWidget/tags/1.0beta3 ${buildout:directory}/products/AddRemoveWidget
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/ATSchemaEditorNG/tags/0.4.7 ${buildout:directory}/products/ATSchemaEditorNG
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/BarraInstitucional/tags/20120507 ${buildout:directory}/products/BarraInstitucional
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/CMFPublicator/tags/20100803 ${buildout:directory}/products/CMFPublicator
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/CMFSin/tags/0.7 ${buildout:directory}/products/CMFSin
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/CustomNav/tags/20090203 ${buildout:directory}/products/CustomNav
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/DataGridField/tags/1.5.0 ${buildout:directory}/products/DataGridField
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/FCKeditor/tags/2.6.6 ${buildout:directory}/products/FCKeditor
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/FileSystemStorage/tags/20100803 ${buildout:directory}/products/FileSystemStorage
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/LinguaPlone/tags/20080723 ${buildout:directory}/products/LinguaPlone
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/Maps/tags/1.1 ${buildout:directory}/products/Maps
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/Ploneboard/tags/1.0 ${buildout:directory}/products/Ploneboard
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/plonegalleryview/tags/0.3.4 ${buildout:directory}/products/plonegalleryview
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/PloneGazette/tags/2.5.4 ${buildout:directory}/products/PloneGazette
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/PloneHelpCenter/tags/1.0_rc-1 ${buildout:directory}/products/PloneHelpCenter
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/PloneSmoothGallery/tags/0.4 ${buildout:directory}/products/PloneSmoothGallery
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/PortalModeloI/tags/20080530 ${buildout:directory}/products/PortalModeloI
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/PREleicoesCNDM/tags/20100602 ${buildout:directory}/products/PREleicoesCNDM
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/PREscolasIrmasGalleryView/tags/20080531 ${buildout:directory}/products/PREscolasIrmasGalleryView
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/PREscolasIrmas/tags/20100601 ${buildout:directory}/products/PREscolasIrmas
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/PRse-portosSkin/tags/20090327 ${buildout:directory}/products/PRse-portosSkin
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/PrSEPSkin/tags/20101015 ${buildout:directory}/products/PrSEPSkin
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/PRTemaSimplesCSSManager/tags/20090821 ${buildout:directory}/products/PRTemaSimplesCSSManager
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/PRTemaSimples/tags/20120510 ${buildout:directory}/products/PRTemaSimples
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/RichEvent/tags/0.1 ${buildout:directory}/products/RichEvent
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/serprodelegislacaoskin/tags/20101201 ${buildout:directory}/products/serprodelegislacaoskin
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROPortalPresidenciaSkin/tag/20110914 ${buildout:directory}/products/SERPROPortalPresidenciaSkin
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSCAcessibilidade/tags/20081013 ${buildout:directory}/products/SERPROSCAcessibilidade
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSCCaptchaField/tags/20100803 ${buildout:directory}/products/SERPROSCCaptchaField
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSCControleEdicoes/tags/20090423 ${buildout:directory}/products/SERPROSCControleEdicoes
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSCEquidadeGeneros/tags/20090306 ${buildout:directory}/products/SERPROSCEquidadeGeneros
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSCGaleriaImagensView/tags/20081007 ${buildout:directory}/products/SERPROSCGaleriaImagensView
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSCInscricaoPrefeitos/tags/20090218 ${buildout:directory}/products/SERPROSCInscricaoPrefeitos
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSCNewsletterConfig/tags/20081125 ${buildout:directory}/products/SERPROSCNewsletterConfig
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSCNewsletterSkinJuventude/tags/20081125 ${buildout:directory}/products/SERPROSCNewsletterSkinJuventude
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSCNewsletter/tags/20081125 ${buildout:directory}/products/SERPROSCNewsletter
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSCRevistaJuridicaArtigo/tags/20091224 ${buildout:directory}/products/SERPROSCRevistaJuridicaArtigo
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSCRevistaJuridicaSkin/trunk/20110816 ${buildout:directory}/products/SERPROSCRevistaJuridicaSkin
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSecretariaPresidencia/tags/20120420 ${buildout:directory}/products/SERPROSecretariaPresidencia
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SignupSheet/tags/20090326 ${buildout:directory}/products/SignupSheet
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/TALESField/tags/1.1 ${buildout:directory}/products/TALESField
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/TemplateFields/tags/1.1 ${buildout:directory}/products/TemplateFields
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/WebLionLibrary/tags/20090211 ${buildout:directory}/products/WebLionLibrary
    svn co https://apore.presidencia.gov.br/svn/projetosweb/ProdutosPlone/SERPROSCSAFSkin/tags/20100623 ${buildout:directory}/products/SERPROSCSAFSkin
update-command = ${Products:command}

############################################
# Backup Directory
# ----------------
# Sets the target directory for the bin/backup and bin/snapshotbackup
# commands. Default is inside this project's var directory, but ideally
# this should be on a separate volume or backup server.
#
backups-dir=${buildout:directory}/var

# Don't download new things unless needed to satisfy dependencies.
# Override this on the command line with the "-n" flag.
newest = false

[zeoserver]
recipe = plone.recipe.zope2zeoserver
zope2-location = ${zope2:location}
eggs = tempstorage
pid-file    = ${buildout:directory}/var/zeoserver/zeoserver.pid
socket-name = ${buildout:directory}/var/zeoserver/zeo.zdsock
effective-user = ${buildout:effective-user}
#blob-storage = ${buildout:directory}/var/blobstorage
pack-days = 5
file-storage = ${buildout:directory}/var/filestorage/clusterDB.fs
#storage-number = 1
zeo-log     = ${buildout:directory}/var/zeoserver/zeoserver.log
zeo-address = ${buildout:zeo-address}
zeo-conf-additional =
    <filestorage dirti_cgtibd>
       path ${buildout:directory}/var/filestorage/dirti_cgtiBD.fs
    </filestorage>


[instance]
recipe = plone.recipe.zope2instance
zope2-location = ${zope2:location}
user = admin:admin
http-address = ${buildout:instance-address}
zeo-client = off
debug-mode = on
eggs =
    ${buildout:eggs}
zcml =
effective-user = ${buildout:effective-user}
products =
    ${buildout:directory}/products
    ${productdistros:location}
    ${plone:location}
zodb-cache-size = 30000
zserver-threads = 2
#blob-storage = ${buildout:directory}/var/blobstorage
#file-storage = plone255
shared-blob = on
environment-vars =
    PYTHON_EGG_CACHE /opt/cache-buildout/python-eggs
    longrequestlogger_file ${buildout:directory}/var/log/longrequest.log
    longrequestlogger_timeout 8
    longrequestlogger_interval 2
zeo-address = ${buildout:zeo-address}
zeo-client = on
zope-conf-additional =
    <zodb_db dirti_cgtiBD>
        mount-point /dirti_cgti
        cache-size 50000
        <zeoclient>
            server ${zeoserver:zeo-address}
            storage dirti_cgtibd
            name dirti_cgti
        </zeoclient>
    </zodb_db>


[client1]
<= instance
#port-base = 1
http-address = ${buildout:client1-address}
icp-address = ${buildout:client1-address}
event-log = ${buildout:directory}/var/log/client1-event.log
z2-log    = ${buildout:directory}/var/log/client1-Z2.log
pid-file  = ${buildout:directory}/var/log/client1.pid
lock-file = ${buildout:directory}/var/log/client1.lock

[client2]
<= instance
#port-base = 2
http-address = ${buildout:client2-address}
icp-address = ${buildout:client2-address}
event-log = ${buildout:directory}/var/log/client2-event.log
z2-log    = ${buildout:directory}/var/log/client2-Z2.log
pid-file  = ${buildout:directory}/var/log/client2.pid
lock-file = ${buildout:directory}/var/log/client2.lock
###  


[supervisor]
recipe = collective.recipe.supervisor
plugins =
    supervisor>2.1
    superlance
port = ${buildout:supervisor-address}
user = usrsupervisor
password = 123456
#serverurl = http://supervisor.mustap.com
programs =
    05 zeoserver (autostart=true startsecs=05) ${buildout:directory}/bin/zeoserver [console] ${zeoserver:location} true ${buildout:effective-user}
    10 client1   (autostart=true startsecs=10) ${buildout:directory}/bin/client1 [console] ${client1:location} true ${buildout:effective-user}
    15 client2   (autostart=true startsecs=15) ${buildout:directory}/bin/client2 [console] ${client2:location} true ${buildout:effective-user}
    10 instance  (autostart=false startsecs=10) ${buildout:directory}/bin/instance [console] ${instance:location} true ${buildout:effective-user}
    35 haproxy   (autostart=true  startsecs=35)  ${buildout:directory}/bin/haproxy [ -f ${buildout:directory}/etc/haproxy.conf -db ]
    
eventlisteners =
    Memmon TICK_60 ${buildout:directory}/bin/memmon [-p client1=200MB]
    HttpOk (startsecs=20) TICK_60 ${buildout:bin-directory}/httpok [-p site1 -t 20 http://localhost:${buildout:client1-address}/]
groups =
    10 cluster zeoserver,client1,client2

[haproxy-build]
recipe = plone.recipe.haproxy
url = http://dist.plone.org/thirdparty/haproxy-1.4.8.zip
target = linux26

[haproxy-conf]
recipe = collective.recipe.template
input = ${buildout:directory}/etc/templates/haproxy.conf.in
output = ${buildout:directory}/etc/haproxy.conf
maxconn = 24000
ulimit-n = 65536
user = ${buildout:effective-user}
group = ${buildout:effective-user}
bind = *:${buildout:haproxy-address}

[stats]
recipe = zc.recipe.egg
eggs = ${instance:eggs}
interpreter = zopepy
scripts = collective-stats

[cmds]
recipe = plone.recipe.command
command +=
    chown -R ${instance:effective-user} ${buildout:directory}/bin
update-command = ${cmds:command}

[versions]
superlance = 0.6
supervisor = 3.0b1
meld3 = 0.6.9
zc.recipe.egg = 1.2.2
ZopeUndo = 2.12.0
plone.recipe.zeoserver = 1.0a1
